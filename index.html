<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>완전한 테트리스</title>
<style>
  body {
    background: #121725;
    margin: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    font-family: monospace;
    color: #fff;
  }
  #game {
    display: grid;
    grid-template-columns: repeat(10, 30px);
    grid-template-rows: repeat(20, 30px);
    gap: 2px;
    background: #1e2233;
    padding: 5px;
    border: 4px solid #333;
  }
  .cell {
    width: 30px;
    height: 30px;
    background: #121725;
    border-radius: 3px;
  }
  .I { background: #2cdfd4; }
  .J { background: #2c6cdf; }
  .L { background: #df852c; }
  .O { background: #dfce2c; }
  .S { background: #2cdf6d; }
  .Z { background: #df2c2c; }
  .T { background: #a32cdf; }
</style>
</head>
<body>
  <div id="game"></div>
  <script>
    const COLS = 10, ROWS = 20;
    const COLORS = {I:'I', J:'J', L:'L', O:'O', S:'S', Z:'Z', T:'T'};

    const BLOCKS = {
      I: [[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]]],
      J: [[[1,0,0,0],[1,1,1,0],[0,0,0,0],[0,0,0,0]]],
      L: [[[0,0,1,0],[1,1,1,0],[0,0,0,0],[0,0,0,0]]],
      O: [[[0,1,1,0],[0,1,1,0],[0,0,0,0],[0,0,0,0]]],
      S: [[[0,1,1,0],[1,1,0,0],[0,0,0,0],[0,0,0,0]]],
      Z: [[[1,1,0,0],[0,1,1,0],[0,0,0,0],[0,0,0,0]]],
      T: [[[0,1,0,0],[1,1,1,0],[0,0,0,0],[0,0,0,0]]],
    };

    let board = Array.from({length: ROWS}, _ => Array(COLS).fill(0));
    let gameDiv = document.getElementById('game');

    function randomBlock() {
      const keys = Object.keys(BLOCKS);
      const type = keys[Math.floor(Math.random()*keys.length)];
      const shape = BLOCKS[type][0].map(r=>r.slice());
      return {type, shape, row: -1, col: 3};
    }

    let current = randomBlock();

    function rotate(m) {
      const N = m.length, r = Array.from({length:N}, _=>Array(N).fill(0));
      for(let i=0;i<N;i++)for(let j=0;j<N;j++) r[j][N-1-i]=m[i][j];
      return r;
    }

    function collides(s, r, c) {
      for(let i=0;i<s.length;i++)for(let j=0;j<s[i].length;j++) {
        if(s[i][j]) {
          const x=c+j, y=r+i;
          if(x<0||x>=COLS||y>=ROWS|| (y>=0 && board[y][x])) return true;
        }
      }
      return false;
    }

    function wallKick(rot, r, c) {
      for(const d of [0,-1,1,-2,2]) {
        if(!collides(rot, r, c+d)) return c+d;
      }
      return null;
    }

    function rotateCurrent() {
      const nr = rotate(current.shape);
      if(!collides(nr, current.row, current.col)) current.shape = nr;
      else {
        const nc = wallKick(nr, current.row, current.col);
        if(nc !== null) {
          current.shape = nr;
          current.col = nc;
        }
      }
    }

    function fix() {
      current.shape.forEach((r,i) => r.forEach((v,j) => {
        if(v && current.row+i>=0) board[current.row+i][current.col+j] = current.type;
      }));
    }

    function clearLines() {
      for(let y=ROWS-1; y>=0; y--) {
        if(board[y].every(v=>v)) {
          board.splice(y,1);
          board.unshift(Array(COLS).fill(0));
          y++;
        }
      }
    }

    function moveDown() {
      if(!collides(current.shape, current.row+1, current.col)) {
        current.row++;
      } else {
        fix();
        clearLines();
        current = randomBlock();
        if(collides(current.shape, current.row, current.col)) {
          board = Array.from({length: ROWS}, _ => Array(COLS).fill(0));
          alert('게임 오버!');
        }
      }
      draw();
    }

    function move(dx) {
      if(!collides(current.shape, current.row, current.col + dx)) current.col += dx;
      draw();
    }

    document.addEventListener('keydown', e => {
      if(e.code==='ArrowLeft') move(-1);
      else if(e.code==='ArrowRight') move(1);
      else if(e.code==='ArrowUp') rotateCurrent();
      else if(e.code==='ArrowDown') moveDown();
    });

    function draw() {
      gameDiv.innerHTML = '';
      for(let y=0;y<ROWS;y++) {
        for(let x=0;x<COLS;x++){
          const cell = document.createElement('div');
          cell.className = 'cell';
          if(board[y][x]) cell.classList.add(COLORS[board[y][x]]);
          gameDiv.appendChild(cell);
        }
      }
      current.shape.forEach((r,i)=>r.forEach((v,j)=>{
        const y = current.row+i, x = current.col+j;
        if(v && y>=0) gameDiv.children[y*COLS + x].classList.add(COLORS[current.type]);
      }));
    }

    function startGame() {
      setInterval(moveDown, 500);
      draw();
    }

    window.onload = startGame;
  </script>
</body>
</html>
