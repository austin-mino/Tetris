<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<title>üéÆ Classic Tetris</title>
<style>
  :root{
    --bg:#121725;--cell:28px;--gap:1px;--grid:#1e2233;
    --T:#b36be0;--O:#f7d041;--I:#30c3ec;--S:#5ccd6a;--Z:#ef5959;--L:#f69c3c;--J:#5185f7;
  }
  body{margin:0;font-family:'Segoe UI',sans-serif;background:var(--bg);color:#fff;display:flex;flex-direction:column;align-items:center;-webkit-tap-highlight-color:transparent;touch-action:manipulation}
  h1{margin:14px 0 4px;font-size:1.8rem}
  #wrapper{display:flex;gap:18px;margin-top:6px}
  #board{display:grid;gap:var(--gap);background:var(--grid);touch-action:none}
  .cell{width:var(--cell);height:var(--cell);background:#151a28}
  .ghost{opacity:.25}
  .T{background:var(--T)}.O{background:var(--O)}.I{background:var(--I)}.S{background:var(--S)}.Z{background:var(--Z)}.L{background:var(--L)}.J{background:var(--J)}
  #side{display:flex;flex-direction:column;gap:10px}
  .panel{background:#1b2031;border-radius:8px;padding:8px 10px;min-width:100px}
  .panel h3{margin:0 0 4px;font-size:.9rem}
  .mini{display:grid;grid-template-columns:repeat(4,18px);grid-template-rows:repeat(4,18px);gap:1px;background:var(--grid)}
  .mini div{width:18px;height:18px;background:#151a28}
  #controls{display:grid;grid-template-columns:repeat(3,60px);grid-template-rows:repeat(2,60px);gap:8px;margin:14px 0;user-select:none}
  .btn{background:#333;border:2px solid #555;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:1.4rem;color:#fff}
  .btn:active{background:#555}
  #start{padding:8px 18px;border:none;border-radius:6px;background:#4caf50;color:#fff;cursor:pointer;font-size:1rem;margin-top:8px}
  @media(max-width:480px){:root{--cell:22px}.mini{grid-template-columns:repeat(4,14px);grid-template-rows:repeat(4,14px)}#controls{grid-template-columns:repeat(3,50px);grid-template-rows:repeat(2,50px)}}
</style>
</head>
<body>
<h1>üéÆ Classic¬†Tetris</h1>
<button id="start">Í≤åÏûÑ ÏãúÏûë</button>
<div id="wrapper" style="display:none">
  <div id="board"></div>
  <div id="side">
    <div class="panel"><h3>Îã§Ïùå</h3><div id="next" class="mini"></div></div>
    <div class="panel"><h3>Î≥¥Î•ò</h3><div id="hold" class="mini"></div></div>
    <div class="panel"><h3>Ï†êÏàò</h3><div id="score">0</div></div>
    <div class="panel"><h3>Î†àÎ≤®</h3><div id="level">1</div></div>
    <div class="panel"><h3>Ï§Ñ</h3><div id="lines">0</div></div>
  </div>
</div>
<div id="controls" style="display:none">
  <div class="btn" id="left">‚¨ÖÔ∏è</div>
  <div class="btn" id="rotate">üîÑ</div>
  <div class="btn" id="right">‚û°Ô∏è</div>
  <div class="btn" style="grid-column:2/3" id="down">‚¨áÔ∏è</div>
  <div class="btn" style="grid-column:2/3" id="drop">üß®</div>
  <div class="btn" id="holdBtn">‚è∏Ô∏è</div>
</div>
<script>
const rows=20,cols=10,board=document.getElementById('board');
let grid=[],score=0,level=1,lines=0,timer,playing=false,lockDelay=500,lockTimer;
const scoreEl=e('score'),levelEl=e('level'),linesEl=e('lines');
function e(id){return document.getElementById(id)}
const shapes={
 T:[[1,cols,cols+1,cols+2],[1,cols+1,cols+2,cols*2+1],[cols,cols+1,cols+2,cols*2+1],[1,cols,cols+1,cols*2+1]],
 O:[[0,1,cols,cols+1]],
 I:[[1,cols+1,cols*2+1,cols*3+1],[cols,cols+1,cols+2,cols+3]],
 S:[[1,2,cols,cols+1],[0,cols,cols+1,cols*2]],
 Z:[[0,1,cols+1,cols+2],[2,cols,cols+1,cols*2+1]],
 L:[[0,cols,cols*2,cols*2+1],[cols,cols+1,cols+2,2],[0,1,cols+1,cols*2+1],[cols,cols*2,cols*2+1,cols*2+2]],
 J:[[1,cols+1,cols*2+1,cols*2],[0,1,2,cols+2],[1,cols+1,cols*2+1,cols*2+2],[0,cols,cols+1,cols+2]]};
const colors={T:'T',O:'O',I:'I',S:'S',Z:'Z',L:'L',J:'J'};
let queue=[],current,holdPiece=null,canHold=true;
function init(){board.style.gridTemplateColumns=`repeat(${cols},var(--cell))`;board.style.gridTemplateRows=`repeat(${rows},var(--cell))`;grid=[];board.innerHTML='';for(let i=0;i<rows*cols;i++){const d=document.createElement('div');d.className='cell';board.appendChild(d);grid.push(d);}queue=[];for(let i=0;i<5;i++)queue.push(randPiece());drawNext();}
function randPiece(){const keys=Object.keys(shapes);return keys[Math.floor(Math.random()*keys.length)];}
function newPiece(){current={name:queue.shift(),pos:3,rot:0};queue.push(randPiece());canHold=true;drawNext();if(collides(current.shape())){gameOver();}}
Object.defineProperty(Object.prototype,'shape',{value:function(){return shapes[this.name][this.rot];},enumerable:false});
function drawPiece(p,cls){p.shape().forEach(i=>grid[p.pos+i]?.classList.add(cls,colors[p.name]));}
function erasePiece(p){p.shape().forEach(i=>grid[p.pos+i]?.classList.remove('active',colors[p.name],'ghost'));}
function collides(shape,posOff=0){return shape.some(i=>{const ni=current.pos+posOff+i;const x=ni%cols,y=Math.floor(ni/cols);return x<0||x>=cols||y>=rows||grid[ni].classList.contains('frozen');});}
function dropDist(){let d=0;while(!collides(current.shape(),(d+1)*cols))d++;return d;}
function placeGhost(){current.ghost=dropDist();current.shape().forEach(i=>grid[current.pos+i+current.ghost*cols]?.classList.add('ghost',colors[current.name]));}
function clearGhost(){grid.forEach(c=>c.classList.remove('ghost'));}
function lockPiece(){erasePiece(current);drawPiece(current,'frozen');clearLines();newPiece();resetTimer();}
function resetTimer(){clearInterval(timer);timer=setInterval(()=>step(),Math.max(100,700-50*(level-1)));}
function step(){move(0,1);} // soft fall
function move(dx,dy){erasePiece(current);if(!collides(current.shape(),dx+dy*cols)){current.pos+=dx+dy*cols;lockTimer=0;}drawPiece(current,'active');clearGhost();placeGhost();if(dy){if(collides(current.shape(),cols)){if(!lockTimer){lockTimer=Date.now();}else if(Date.now()-lockTimer>lockDelay){lockPiece();}}}}
function rotate(){erasePiece(current);const next=(current.rot+1)%shapes[current.name].length;const kicks=[0,-1,1,-2,2];for(const k of kicks){if(!collides(shapes[current.name][next],k)){current.rot=next;current.pos+=k;break;}}drawPiece(current,'active');clearGhost();placeGhost();}
function hardDrop(){erasePiece(current);const d=dropDist();current.pos+=d*cols;drawPiece(current,'active');score+=d*2;updateScore();lockPiece();}
function clearLines(){let cleared=0;for(let r=rows-1;r>=0;r--){if([...Array(cols).keys()].every(c=>grid[r*cols+c].classList.contains('frozen'))){cleared++;for(let c=0;c<cols;c++)grid[r*cols+c].className='cell';const removed=grid.splice(r*cols,cols);grid.unshift(...removed);grid.forEach(c=>board.appendChild(c));r++;}}
 if(cleared){const pts=[0,100,300,500,800][cleared];score+=pts*level;lines+=cleared;if(lines>=level*10){level++;resetTimer();}updateScore();}}
function hold(){if(!canHold)return;erasePiece(current);clearGhost();if(!holdPiece){holdPiece=current.name;newPiece();}else{[holdPiece,current.name]=[current.name,holdPiece];current.pos=3;current.rot=0;if(collides(current.shape())){gameOver();}}canHold=false;drawHold();drawPiece(current,'active');placeGhost();}
function drawMini(el,piece){el.innerHTML='';const temp=[];for(let i=0;i<16;i++){const d=document.createElement('div');d.className='cell mini';el.appendChild(d);temp.push(d);}if(piece){shapes[piece][0].forEach(i=>{const x=i%cols,y=Math.floor(i/cols);const idx=y*4+x;temp[idx]?.classList.add(colors[piece]);});}}
function drawNext(){drawMini(e('next'),queue[0]);}
function drawHold(){drawMini(e('hold'),holdPiece);} 
function updateScore(){scoreEl.textContent=score;levelEl.textContent=level;linesEl.textContent=lines;}
function gameOver(){alert('Í≤åÏûÑ Ïò§Î≤Ñ! Ï¥ù Ï†êÏàò: '+score);stopGame();}
function start(){document.getElementById('wrapper').style.display='flex';controls.style.display='grid';startBtn.style.display='none';score=0;level=1;lines=0;updateScore();init();newPiece();drawPiece(current,'active');placeGhost();playing=true;resetTimer();}
function stopGame(){playing=false;clearInterval(timer);document.getElementById('wrapper').style.display='none';controls.style.display='none';startBtn.style.display='block';}
// input
startBtn.onclick=start;
document.addEventListener('keydown',e=>{if(!playing)return;switch(e.key){case'ArrowLeft':move(-1,0);break;case'ArrowRight':move(1,0);break;case'ArrowDown':move(0,1);score++;updateScore();break;case'ArrowUp':rotate();break;case' ':e.preventDefault();hardDrop();break;case'Shift':case'c':hold();break;}});
[['left',()=>move(-1,0)],['right',()=>move(1,0)],['down',()=>move(0,1)],['rotate',rotate],['drop',hardDrop],['holdBtn',hold]].forEach(([id,fn])=>{e(id)?.addEventListener('touchstart',ev=>{ev.preventDefault();fn();});});
</script>
</body>
</html>
