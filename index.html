<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>🎮 테트리스</title>
  <style>
    :root { --cell: 30px; --gap: 1px; --bg: #0e0e0e; --active: #4fc3f7; --frozen: #1565c0; }
    body { margin:0;font-family:'Segoe UI',sans-serif;display:flex;flex-direction:column;align-items:center;background:var(--bg);color:#fff; }
    h1{margin:20px 0 10px}
    #info{display:flex;gap:20px;align-items:center}
    #score{font-size:1.2rem}
    #game{display:grid;gap:var(--gap);background:#111;margin-top:10px;touch-action:none}
    .cell{width:var(--cell);height:var(--cell);background:#1e1e1e}
    .active{background:var(--active)}
    .frozen{background:var(--frozen)}
    #controls{margin:15px 0;display:grid;grid-template-columns:repeat(3,60px);grid-template-rows:repeat(2,60px);gap:10px;user-select:none}
    .btn{background:#333;border:2px solid #555;border-radius:8px;color:#fff;font-size:1.4rem;display:flex;align-items:center;justify-content:center}
    .btn:active{background:#555}
    #startBtn{margin-top:10px;padding:8px 14px;font-size:1rem;border:none;border-radius:6px;background:#4caf50;color:#fff;cursor:pointer}
    @media(hover:hover){#controls{display:none}}
    @media(max-width:480px){:root{--cell:24px;}#controls{grid-template-columns:repeat(3,50px);grid-template-rows:repeat(2,50px);} .btn{font-size:1.2rem;} #startBtn{font-size:.95rem;padding:6px 12px;} }
  </style>
</head>
<body>
  <h1>🎮 테트리스</h1>
  <button id="startBtn">게임 시작</button>
  <div id="info" style="display:none"><span id="score">점수: 0</span></div>
  <div id="game"></div>
  <div id="controls" style="display:none">
    <div class="btn" id="left">⬅️</div>
    <div class="btn" id="rotate">🔄</div>
    <div class="btn" id="right">➡️</div>
    <div class="btn" style="grid-column:2/3" id="down">⬇️</div>
  </div>
<script>
const rows=20,cols=10,game=document.getElementById('game');
const startBtn=document.getElementById('startBtn');
const info=document.getElementById('info');
const scoreEl=document.getElementById('score');
const controls=document.getElementById('controls');
let cells=[],currentSet,current,pos,rot,score=0,interval=700,dropTimer,playing=false;

function buildGrid(){game.innerHTML='';cells=[];game.style.gridTemplateColumns=`repeat(${cols}, var(--cell))`;game.style.gridTemplateRows=`repeat(${rows}, var(--cell))`;for(let i=0;i<rows*cols;i++){const d=document.createElement('div');d.className='cell';game.appendChild(d);cells.push(d);} }

const T=[[1,cols,cols+1,cols+2],[1,cols+1,cols+2,cols*2+1],[cols,cols+1,cols+2,cols*2+1],[1,cols,cols+1,cols*2+1]];
const O=[[0,1,cols,cols+1]];
const I=[[1,cols+1,cols*2+1,cols*3+1],[cols,cols+1,cols+2,cols+3]];
const S=[[1,2,cols,cols+1],[0,cols,cols+1,cols*2]];
const Z=[[0,1,cols+1,cols+2],[2,cols,cols+1,cols*2+1]];
const L=[[0,cols,cols*2,cols*2+1],[cols,cols+1,cols+2,2],[0,1,cols+1,cols*2+1],[cols,cols*2,cols*2+1,cols*2+2]];
const J=[[1,cols+1,cols*2+1,cols*2],[0,1,2,cols+2],[1,cols+1,cols*2+1,cols*2+2],[0,cols,cols+1,cols+2]];
const SHAPES=[T,O,I,S,Z,L,J];
function randomShape(){const t=SHAPES[Math.floor(Math.random()*SHAPES.length)];return {shape:t,rot:0};}
let next=randomShape();
function draw(){current.forEach(i=>cells[pos+i]?.classList.add('active'));}
function undraw(){current.forEach(i=>cells[pos+i]?.classList.remove('active'));}
function freeze(){current.forEach(i=>cells[pos+i]?.classList.replace('active','frozen'));}

function spawn(){({shape:currentSet,rot}=next);next=randomShape();current=currentSet[rot];pos=3;
 if(current.some(i=>cells[pos+i].classList.contains('frozen'))){alert('게임 오버!');stopGame();return;} draw();}

function wallKick(test,offsets){for(const off of offsets){if(test.every(i=>{const ni=pos+off+i;return ni>=0&&ni<rows*cols&&!cells[ni].classList.contains('frozen')&&(ni%cols)<cols;})){pos+=off;return true;}}return false;}
function rotate(){if(!playing)return;undraw();const nextRot=(rot+1)%currentSet.length;const test=currentSet[nextRot];const kicks=[0,-1,1,-cols];if(wallKick(test,kicks)){rot=nextRot;current=currentSet[rot];} draw();}
function move(dx){if(!playing)return;undraw();if(current.some(i=>{const ni=pos+i+dx;return ni<0||ni>=rows*cols||Math.floor((pos+i)/cols)!==Math.floor(ni/cols)||cells[ni].classList.contains('frozen');})){draw();return;} pos+=dx;draw();}
function moveDown(manual=false){if(!playing)return;undraw();if(current.some(i=>{const ni=pos+i+cols;return ni>=rows*cols||cells[ni].classList.contains('frozen');})){draw();freeze();clearLines();spawn();return;} pos+=cols;draw();if(manual){score++;updateScore();}}

function clearLines(){for(let r=rows-1;r>=0;r--){const isFull=[...Array(cols).keys()].every(c=>cells[r*cols+c].classList.contains('frozen'));if(isFull){score+=10;updateScore(); for(let c=0;c<cols;c++){cells[r*cols+c].classList.remove('frozen');} // remove row
 const row=cells.splice(r*cols,cols); // delete from array
 row.forEach(cell=>{cell.className='cell';});
 cells.unshift(...row); // add as empty row on top
 cells.forEach(c=>c.classList.remove('active')); // ensure no stray active
 game.innerHTML=''; cells.forEach(c=>game.appendChild(c)); r++;}}
}
function updateScore(){scoreEl.textContent='점수: '+score;}
function startGame(){if(playing)return;startBtn.style.display='none';info.style.display='flex';controls.style.display='grid';buildGrid();score=0;updateScore();playing=true;next=randomShape();spawn();dropTimer=setInterval(()=>moveDown(false),interval);} 
function stopGame(){playing=false;clearInterval(dropTimer);startBtn.style.display='block';controls.style.display='none';}

// Keyboard
document.addEventListener('keydown',e=>{if(!playing)return; if(e.key==='ArrowLeft')move(-1); else if(e.key==='ArrowRight')move(1); else if(e.key==='ArrowUp')rotate(); else if(e.key==='ArrowDown')moveDown(true);});
// Touch
[['left',()=>move(-1)],['right',()=>move(1)],['rotate',rotate],['down',()=>moveDown(true)]].forEach(([id,fn])=>{document.getElementById(id)?.addEventListener('touchstart',e=>{e.preventDefault();fn();});});
startBtn.addEventListener('click',startGame);
</script>
</body>
</html>
